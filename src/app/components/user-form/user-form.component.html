<div class="form-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{
        isEditMode ? "Edit User" : "Add New User"
      }}</mat-card-title>
      <mat-card-subtitle>
        {{
          isEditMode
            ? "Update user information"
            : "Fill in the details to create a new user"
        }}
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div *ngIf="loading && isEditMode" class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading user data...</p>
      </div>

      <div *ngIf="error" class="error-message">
        <span class="error-icon">⚠️</span>
        {{ error }}
      </div>

      <div *ngIf="success" class="success-message">
        <span class="success-icon">✅</span>
        User {{ isEditMode ? "updated" : "created" }} successfully!
        Redirecting...
      </div>

      <form
        [formGroup]="userForm"
        (ngSubmit)="onSubmit()"
        *ngIf="!loading || !isEditMode"
      >
        <!-- Personal Information Section -->
        <div class="form-section">
          <h3>Personal Information</h3>

          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>First Name *</mat-label>
              <input
                matInput
                formControlName="firstName"
                placeholder="Enter first name"
              />
              <mat-icon matSuffix>person</mat-icon>
              <mat-error *ngIf="getFieldError('firstName')">{{
                getFieldError("firstName")
              }}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Last Name *</mat-label>
              <input
                matInput
                formControlName="lastName"
                placeholder="Enter last name"
              />
              <mat-icon matSuffix>person</mat-icon>
              <mat-error *ngIf="getFieldError('lastName')">{{
                getFieldError("lastName")
              }}</mat-error>
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email Address *</mat-label>
            <input
              matInput
              type="email"
              formControlName="email"
              placeholder="Enter email address"
            />
            <mat-icon matSuffix>email</mat-icon>
            <mat-error *ngIf="getFieldError('email')">{{
              getFieldError("email")
            }}</mat-error>
          </mat-form-field>

          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Phone Number *</mat-label>
              <input
                matInput
                type="tel"
                formControlName="phone"
                placeholder="Enter phone number"
              />
              <mat-icon matSuffix>phone</mat-icon>
              <mat-error *ngIf="getFieldError('phone')">{{
                getFieldError("phone")
              }}</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Age</mat-label>
              <input
                matInput
                type="number"
                formControlName="age"
                placeholder="Enter age (optional)"
              />
              <mat-icon matSuffix>cake</mat-icon>
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>University</mat-label>
            <input
              matInput
              formControlName="university"
              placeholder="Enter university (optional)"
            />
            <mat-icon matSuffix>school</mat-icon>
          </mat-form-field>
        </div>

        <!-- Company Information Section -->
        <div class="form-section">
          <h3>Company Information</h3>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Company Name</mat-label>
            <input
              matInput
              formControlName="companyName"
              placeholder="Enter company name (optional)"
            />
            <mat-icon matSuffix>business</mat-icon>
          </mat-form-field>
        </div>

        <!-- Address Information Section -->
        <div class="form-section">
          <h3>Address Information</h3>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Street Address</mat-label>
            <input
              matInput
              formControlName="address"
              placeholder="Enter street address (optional)"
            />
            <mat-icon matSuffix>home</mat-icon>
          </mat-form-field>

          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>City</mat-label>
              <input
                matInput
                formControlName="city"
                placeholder="Enter city (optional)"
              />
              <mat-icon matSuffix>location_city</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Postal Code</mat-label>
              <input
                matInput
                formControlName="postalCode"
                placeholder="Enter postal code (optional)"
              />
              <mat-icon matSuffix>markunread_mailbox</mat-icon>
            </mat-form-field>
          </div>
        </div>
      </form>
    </mat-card-content>

    <mat-card-actions align="end">
      <button mat-button type="button" (click)="cancel()" [disabled]="loading">
        Cancel
      </button>
      <button
        mat-raised-button
        color="primary"
        type="submit"
        (click)="onSubmit()"
        [disabled]="loading || success"
      >
        <mat-spinner
          *ngIf="loading"
          diameter="20"
          class="button-spinner"
        ></mat-spinner>
        <span *ngIf="!loading">{{
          isEditMode ? "Update User" : "Create User"
        }}</span>
        <span *ngIf="loading">Processing...</span>
      </button>
    </mat-card-actions>
  </mat-card>
</div>
