<div class="user-list-container">
  <div class="header">
    <h2>User Management</h2>
    <a mat-raised-button color="primary" routerLink="/users/new">
      <mat-icon>add</mat-icon>
      Add New User
    </a>
  </div>

  <!-- Filter and Search Controls -->
  <mat-card class="filter-card">
    <mat-card-content>
      <form [formGroup]="filterForm" class="filter-form">
        <div class="filter-row">
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Search users</mat-label>
            <input
              matInput
              formControlName="search"
              placeholder="Search by name, email..."
            />
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>

          <mat-form-field appearance="outline" class="sort-field">
            <mat-label>Sort by</mat-label>
            <mat-select formControlName="sortBy">
              <mat-option value="">None</mat-option>
              <mat-option
                *ngFor="let option of sortOptions"
                [value]="option.value"
              >
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="order-field">
            <mat-label>Order</mat-label>
            <mat-select
              formControlName="sortOrder"
              [disabled]="!filterForm.get('sortBy')?.value"
            >
              <mat-option value="asc">Ascending</mat-option>
              <mat-option value="desc">Descending</mat-option>
            </mat-select>
          </mat-form-field>

          <button
            mat-stroked-button
            color="warn"
            (click)="clearFilters()"
            [disabled]="activeFilters.length === 0"
            class="clear-button"
          >
            <mat-icon>clear</mat-icon>
            Clear
          </button>
        </div>

        <!-- Active Filters Display -->
        <div class="active-filters" *ngIf="activeFilters.length > 0">
          <span class="filters-label">Active filters:</span>
          <mat-chip-listbox>
            <mat-chip *ngFor="let filter of activeFilters">
              {{ filter }}
            </mat-chip>
          </mat-chip-listbox>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Results Summary -->
  <div class="results-summary" *ngIf="!loading && !error">
    <span>Showing {{ users.length }} of {{ totalUsers }} users</span>
  </div>

  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading users...</p>
  </div>

  <div *ngIf="error && !loading" class="error-container">
    <mat-card class="error-card">
      <mat-card-content>
        <div class="error-content">
          <mat-icon color="warn">error</mat-icon>
          <span>{{ error }}</span>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button mat-button color="primary" (click)="loadUsers()">
          <mat-icon>refresh</mat-icon>
          Retry
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <div *ngIf="!loading && !error" class="users-grid">
    <mat-card *ngFor="let user of users" class="user-card">
      <mat-card-header>
        <div mat-card-avatar class="user-avatar">
          {{ user.firstName.charAt(0).toUpperCase() }}
        </div>
        <mat-card-title
          >{{ user.firstName }} {{ user.lastName }}</mat-card-title
        >
        <mat-card-subtitle>{{ user.email }}</mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="user-details">
          <div class="detail-item">
            <mat-icon>phone</mat-icon>
            <span>{{ user.phone }}</span>
          </div>
          <div class="detail-item" *ngIf="user.age">
            <mat-icon>cake</mat-icon>
            <span>{{ user.age }} years old</span>
          </div>
          <div class="detail-item" *ngIf="user.company">
            <mat-icon>business</mat-icon>
            <span>{{ user.company.name }}</span>
          </div>
          <div class="detail-item" *ngIf="user.address">
            <mat-icon>location_on</mat-icon>
            <span>{{ user.address.address }}, {{ user.address.city }}</span>
          </div>
          <div class="detail-item" *ngIf="user.university">
            <mat-icon>school</mat-icon>
            <span>{{ user.university }}</span>
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button
          mat-button
          color="primary"
          [routerLink]="['/users/edit', user.id]"
        >
          <mat-icon>edit</mat-icon>
          Edit
        </button>
        <button mat-button color="warn" (click)="deleteUser(user.id)">
          <mat-icon>delete</mat-icon>
          Delete
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Pagination -->
  <div
    class="pagination-container"
    *ngIf="!loading && !error && totalUsers > 0"
  >
    <mat-paginator
      [length]="totalUsers"
      [pageSize]="pageSize"
      [pageIndex]="currentPage"
      [pageSizeOptions]="pageSizeOptions"
      [showFirstLastButtons]="true"
      (page)="onPageChange($event)"
      aria-label="Select page"
    >
    </mat-paginator>
  </div>

  <div *ngIf="!loading && !error && users.length === 0" class="empty-state">
    <mat-card class="empty-card">
      <mat-card-content>
        <div class="empty-content">
          <mat-icon class="empty-icon">people_outline</mat-icon>
          <h3>No users found</h3>
          <p *ngIf="activeFilters.length === 0">
            Start by adding your first user
          </p>
          <p *ngIf="activeFilters.length > 0">
            No users match your current filters
          </p>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <a
          mat-raised-button
          color="primary"
          routerLink="/users/new"
          *ngIf="activeFilters.length === 0"
        >
          <mat-icon>add</mat-icon>
          Add User
        </a>
        <button
          mat-stroked-button
          (click)="clearFilters()"
          *ngIf="activeFilters.length > 0"
        >
          <mat-icon>clear</mat-icon>
          Clear Filters
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
